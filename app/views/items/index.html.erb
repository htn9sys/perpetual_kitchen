<div class="item-main">
  <div class="form-wrap3">
    <%= render 'shared/loading' %>
    <%= render 'shared/header' %>

    <div class="kitchen-container_item">
      <% kitchen_type = KitchenType.find_by(id: @kitchen.kitchen_type_id) %>
      <% if kitchen_type %>
        <h2><b><%= kitchen_type.name %></b> (<%= @kitchen.name %>)</h2>
        <div id="edit-form-<%= @kitchen.id %>" class="edit-form" style="display: none;">
          <%= form_for(@kitchen, url: kitchen_path(@kitchen), method: :patch) do |f| %>
            <%= f.text_field :name %>
            <%= f.submit "更新" %>
          <% end %>
        </div>
        <div class="edit-buttons">
          <button class="edit-button" data-kitchen-id="<%= @kitchen.id %>">編集</button>
          <%= link_to "削除", kitchen_path(@kitchen), method: :delete, data: { confirm: "本当に削除しますか？" } %>
        </div>
      <% else %>
        <h2>Unknown Type (<%= @kitchen.name %>)</h2>
      <% end %>

      <script>
        const editButtons = document.querySelectorAll(".edit-button");
        editButtons.forEach((button) => {
          button.addEventListener("click", () => {
            const kitchenId = button.getAttribute("data-kitchen-id");
            const editForm = document.getElementById(`edit-form-${kitchenId}`);
            editForm.style.display = "block";
          });
        });
      </script>

      <div class="item-container">
        <table class="item-list">
          <thead>
            <tr>
              <th>名前</th>
              <th>数量</th>
              <th>期限</th>
              <th>日付</th>
              <th>説明</th>
            </tr>
          </thead>
          <tbody>
            <% @items.order(date: :desc).each do |item| %>
              <tr>
                <td><%= item.name %></td>
                <td><%= item.quantity %> (<%= Unit.find_by(id: item.unit_id)&.name %>)</td>
                <td><%= DateType.find_by(id: item.date_type_id)&.name %></td>
                <td><%= item.date.strftime('%Y/%m/%d') %></td>
                <td><%= item.description %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <div class="item-form">
        <%= form_with(model: Item.new, url: kitchen_items_path(@kitchen), local: true) do |form| %>
          <div class="field">
            <%= form.label :name, "名前" %>
            <%= form.text_field :name %>
          </div>
          <div class="field">
            <%= form.label :quantity, "数量" %>
            <%= form.number_field :quantity %>
          </div>
          <div class="field">
            <%= form.label :unit_id, "単位" %>
            <%= form.select :unit_id, options_for_select(Unit.all.map { |u| [u.name, u.id] }) %>
          </div>
          <div class="field">
            <%= form.label :date_type_id, "期限の種類" %>
            <%= form.select :date_type_id, options_for_select(DateType.all.map { |d| [d.name, d.id] }) %>
          </div>
          <div class="field">
            <%= form.label :date, "日付" %>
            <%= form.date_field :date %>
          </div>
          <div class="field">
            <%= form.label :description, "説明(任意)" %>
            <%= form.text_area :description %>
          </div>
          <div class="actions">
            <div class="field">
              <%= form.submit "保存" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <script src="button.js"></script>
    <%= render 'shared/icon_top' %>
  </div>
</div>
